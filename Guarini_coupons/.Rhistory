library(readxl)
library(tidyverse)
d <- read_excel("guarini_coupon.xls",sheet = "Data")
View(d)
View(d)
mod <- lm(SALES~PROMO+lag(PROMO))
mod <- lm(SALES~PROMO+lag(PROMO),d)
summary(mod)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY,d)
summary(mod)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES),d)
summary(mod)
View(d)
View(d)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+SUMMER,d)
summary(mod)
plot(d$SALES)
plot(d$SALES,type="l")
ablines(lm(d$SALES~d$WEEK))
alines(lm(d$SALES~d$WEEK))
lines(lm(d$SALES~d$WEEK))
ablines(lm(d$SALES~d$WEEK))
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d),col="blue",type="l")
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d),col="blue",type="l")
error <- d$SALES - predict(mod,d)
error <- d$SALES[2:length(d$SALES)] - predict(mod,d)
error <- d$SALES[2:length(d$SALES)] - predict(mod,d)
d$SALES[2:104]
length(d$SALES[2:104])
lines(predict(mod,d[2:length(d$SALES)]),col="blue",type="l")
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES[2:length(d$SALES)] - predict(mod,d[2:length(d$SALES),])
error <- d$SALES[2:length(d$SALES)] - predict(mod,d[2:length(d$SALES),])
error <- d$SALES[3:length(d$SALES)] - predict(mod,d[3:length(d$SALES),])
error <- d$SALES - predict(mod,d)
max(error)
max(error,na.rm = T)
error
which(max(error,na.rm = T))
which(error==max(error,na.rm = T))
which(error==max(error,na.rm = T))
error[10]
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
View(d)
d$error <- error
plot(error,type="l")
error_sum <- d %>% group_by(MONTH) %>% summarise(mean(error))
View(error_sum)
error_sum <- d %>% group_by(MONTH) %>% summarise(mean(error),na.omit(NA))
error_sum <- d[2:104] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum <- d[2:104,] %>% group_by(MONTH) %>% summarise(mean(error))
View(error_sum)
error_sum <- d[2:104,] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum
View(error_sum)
error_sum <- d[2:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
View(error_sum)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+SUMMER,d)
summary(mod)
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
d$error <- error
plot(error,type="l")
error_sum <- d[2:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
View(error_sum)
View(d)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d)
summary(mod)
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
d$error <- error
plot(error,type="l")
error_sum <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum
error_sum_abs <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum_abs
error_sum <-  d[3:104,] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum_abs <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum_abs
error_sum <-  d[3:104,] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum
d_factor <- d
quantile(d)
quantile(d,"na.rm")
quantile(d,na.rm)
d <- read_excel("guarini_coupon.xls",sheet = "Data")
d <- read_excel("guarini_coupon.xls",sheet = "Data")
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d)
summary(mod)
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
d$error <- error
plot(error,type="l")
error_sum_abs <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
library(readxl)
library(tidyverse)
d <- read_excel("guarini_coupon.xls",sheet = "Data")
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d)
summary(mod)
plot(d$SALES[2:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[2:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
d$error <- error
plot(error,type="l")
error_sum_abs <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum_abs
error_sum <-  d[3:104,] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum
d_factor <- d
quantile(d$PROMO)
d_factor$PROMO <- ifelse(d_factor$PROMO>1176.25,1,0)
View(d_factor)
mod_fact <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d_factor)
summary(mod_fact)
quantile(d$PROMO)
d_factor$PROMO <- ifelse(d_factor$PROMO>946,1,0)
mod_fact <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d_factor)
summary(mod_fact)
d_factor <- d
d_factor$PROMO <- ifelse(d_factor$PROMO>946,1,0)
mod_fact <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d_factor)
summary(mod_fact)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d)
summary(mod)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO))),d_fact)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO))),d_factor)
summary(mod_promo)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO))),d_factor)
summary(mod_promo)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO)))+lag(lag(lag(lag(PROMO)))),d_factor)
summary(mod_promo)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO))),d_factor)
summary(mod_promo)
plot(d$SALES[3:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[3:length(d$SALES),]),col="blue",type="l")
plot(d$SALES[1:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[1:length(d$SALES),]),col="blue",type="l")
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER+as.factor(MONTH),d)
summary(mod)
plot(d$SALES[1:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[1:length(d$SALES),]),col="blue",type="l")
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER+as.factor(MONTH)+
lag(lag(PROMO))+lag(lag(lag(PROMO)))+lag(lag(lag(lag(PROMO)))),d)
summary(mod)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO)))+lag(lag(lag(lag(PROMO)))),d)
summary(mod_promo)
which(error==max(error,na.rm = T))
View(d)
View(error_sum)
View(error_sum_abs)
d$error
d$error
mean(d$error)
mean(d$error,na.rm = T)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO)),d)
summary(mod_promo)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER+as.factor(MONTH)+
lag(lag(PROMO))+lag(lag(lag(PROMO)))+lag(lag(lag(lag(PROMO)))),d)
summary(mod)
plot(d$SALES,d$PROMO)
plot(d$SALES,d$PROMO,type="l")
plot(d$PROMO,d$SALES,type="l")
plot(d$SALES[1:length(d$SALES)],type="dÂ·)
plot(d$PROMO,d$SALES,type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[1:length(d$SALES),]),col="blue",type="l")
error <- d$SALES - predict(mod,d)
which(error==max(error,na.rm = T))
d$error <- error
plot(error,type="l")
error_sum_abs <- d[3:104,] %>% group_by(MONTH) %>% summarise(abs(mean(error)))
error_sum_abs
error_sum <-  d[3:104,] %>% group_by(MONTH) %>% summarise(mean(error))
error_sum
d_factor <- d
d_factor$PROMO <- ifelse(d_factor$PROMO>946,1,0)
mod_fact <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d_factor)
summary(mod_fact)
mod_promo <- lm(SALES ~PROMO+lag(PROMO)+lag(lag(PROMO))+lag(lag(lag(PROMO))),d_factor)
summary(mod_promo)
plot(d$SALES[1:length(d$SALES)],type="d")
plot(d$PROMO,d$SALES,type="l")
plot(d$SALES[1:length(d$SALES)])
plot(d$SALES[1:length(d$SALES)])
plot(d$SALES[1:length(d$SALES)],type="l")
abline(lm(d$SALES~d$WEEK))
lines(predict(mod,d[1:length(d$SALES),]),col="blue",type="l")
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER+
lag(lag(PROMO))),d)
mod <- lm(SALES~PROMO+lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER+
lag(lag(PROMO)),d)
summary(mod)
View(d)
mod <- lm(SALES~lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,d)
summary(mod)
View(d)
veronica <- read_excel("guarini_coupon_veronica.xls",sheet = "data")
veronica <- read_excel("guarini_coupon_veronica.xls",sheet = "Data")
cor(dplyr::select_if(d,is_numeric()))
cor(dplyr::select_if(d,is_numeric)
cor(dplyr::select_if(d,is_numeric))
cor(dplyr::select_if(d,is_numeric))
d_cor <- d %>%na.omit(.)
cor(d_cor)
cor(dplyr::select_if(d_cor,is_numeric))
abline(lm(d$SALES~d$WEEK),col="red")
abline(lm(d$SALES~d$WEEK),col="dark green")
train <- d[1:95,]
test <- d[95:104,]
reg_4 <- lm(mod <- lm(SALES~lag(PROMO)+as.factor(WEEKMONTH)+XMAS+HOLIDAY+lag(SALES)+lag(lag(SALES))+WEEK+SUMMER,train))
summary(reg_4)
test$forecast <- predict(reg_4,test)
cor(test$SALES,test$SALES)^2
View(test)
cor(test$SALES,test$SALES,"pairwise.complete.obs")^2
cor(test$SALES,test$forecast,"pairwise.complete.obs")^2
